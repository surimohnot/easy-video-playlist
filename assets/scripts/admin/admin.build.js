(()=>{"use strict";var e=window.EVP_Admin_Data||{};const t={ajaxUrl:e.ajaxurl,playList:e.videoPlaylist||[],security:e.security,i18n:e.i18n,api:e.api||{},setpage:e.setpage};function i(){var e=arguments,t=e[0];return(t=t.replace(/>\s+</g,"><")).replace(/{(\d+)}/g,(function(t,i){return void 0!==e[i]?e[i]:t}))}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,s(a.key),a)}}function s(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:String(t)}const l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.playListItems=t.playList||{},this.listManager=jQuery("#evp-playlist-manager"),this.api=t.api||{}}var a,s;return a=e,s=[{key:"init",value:function(){this.render(),this.events()}},{key:"render",value:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(0!==this.listManager.length){var a,n,s,l;if(0===Object.keys(this.playListItems).length)return this.listManager.find(".evp-playlists-index-list").empty(),this.renderPlaylist(),this.listManager.find(".evp-playlists-index").hide(),void this.listManager.find(".evp-create-new legend").text(null!==(a=null===(n=t.i18n)||void 0===n?void 0:n.createfirst)&&void 0!==a?a:"");this.listManager.find(".evp-create-new legend").text(null!==(s=null===(l=t.i18n)||void 0===l?void 0:l.createnew)&&void 0!==s?s:""),this.listManager.find(".evp-video-index-list").sortable({change:function(t,i){e.listManager.addClass("evp-video-sorted")}}),this.renderPlaylistIndex(i),this.renderPlaylist(i)}}},{key:"events",value:function(){this.listManager.find(".evp-add-playlist-btn").on("click",this.addNewPlaylist.bind(this)),this.listManager.find(".evp-open-addvideo-modal").on("click",this.openAddVideoModal.bind(this)),this.listManager.find(".evp-video-modal").on("click",".evp-cancel-add-video",this.closeVideoModal.bind(this)),this.listManager.find(".evp-video-modal").on("click",".evp-add-video-btn",this.addNewVideo.bind(this)),this.listManager.find(".evp-video-modal").on("click",".evp-save-edit-info-btn",this.saveEditVideoInfo.bind(this)),this.listManager.find(".evp-playlists-index-list").on("click",".evp-play-list-item",this.openPlaylist.bind(this)),this.listManager.find(".evp-delete-playlist").on("click",this.deletePlaylist.bind(this)),this.listManager.find(".evp-video-index-list").on("click",".evp-edit-video-info",this.openEditVideoModal.bind(this)),this.listManager.find(".evp-video-index-list").on("click",".evp-delete-video",this.deleteVideo.bind(this)),this.listManager.find(".evp-save-playlist-sorting").on("click",this.savePlaylistSorting.bind(this)),this.listManager.find(".evp-playlist-content-tabs-item").on("click",this.toggleTabs.bind(this))}},{key:"renderPlaylistIndex",value:function(e){var t=this,i=this.listManager.find(".evp-playlists-index-list"),a="".concat(Object.keys(this.playListItems).map((function(i){var a="evp-play-list-item";return i===e&&(a+=" evp-play-list-item-active"),'<li class="'.concat(a,'" data-id="').concat(i,'"><span class="evp-play-list-item-title-text">').concat(t.playListItems[i].title,"</span></li>")})).join(""));i.html(a),e||i.find(".evp-play-list-item").first().addClass("evp-play-list-item-active"),this.listManager.find(".evp-playlists-index").show()}},{key:"renderPlaylist",value:function(e){var t=Object.keys(this.playListItems),i=e||(t.length?t[0]:""),a=i?this.playListItems[i]:"";if(a){var n=this.listManager.find(".evp-playlists-content"),s=n.find(".evp-video-index-list"),l=a.videos||{},o="".concat(Object.keys(l).map((function(e){var t=l[e],i=t.url||"",a=t.title||"Untitled Video";return i?'<li class="evp-video-listitem" data-video="'.concat(i,'" data-key="').concat(e,'"><span class="evp-video-listitem-title">').concat(a,'</span><span><button class="evp-edit-video-info"><span class="dashicons dashicons-edit"></span></button><button class="evp-delete-video"><span class="dashicons dashicons-no-alt"></span></button></span></li>'):""})).join(""));n.find(".evp-playlist-title-text").text(a.title),n.attr("data-id",i),s.html(o),this.listManager.find(".evp-video-index-list").sortable("refresh"),n.show(),this.listManager.find(".evp-playlists-no-content").hide(),n.find(".evp-playlist-shortcode").html('[evpvideoplaylist playlist="'+i+'"]')}else{var d=this.listManager.find(".evp-playlists-content");d.find(".evp-playlist-title-text").empty(),d.find(".evp-video-index-list").empty(),d.find(".evp-playlist-shortcode").empty(),d.hide(),this.listManager.find(".evp-playlists-no-content").show()}}},{key:"addNewPlaylist",value:function(){var e=this,i=this.listManager.find(".evp-playlist-name").val();if(i){var a=i.toLowerCase().replace(/\s/g,"-");if(this.playListItems[a])console.log("Playlist already exists.");else{var n={action:"evp_add_new_playlist",security:t.security,playlist:i};jQuery.post(t.ajaxUrl,n,(function(t){if(t.success){var a=t.data;a&&(e.playListItems[a]={title:i,videos:{}}),e.render(a),e.listManager.find(".evp-playlist-name").val("")}}),"json")}}else console.log("Please enter a playlist name.")}},{key:"openAddVideoModal",value:function(){var e=jQuery(".evp-video-modal"),a=t.i18n,n=jQuery(i('<div class="evp-add-video-form">\n        <input type="text" class="evp-video-url" placeholder="{1}">\n        <button class="evp-add-video-btn">\n            <span class="dashicons dashicons-plus-alt"></span>\n            <span>{2}</span>\n        </button>\n        <button class="evp-cancel-add-video">\n            <span class="dashicons dashicons-no"></span>\n            <span>{3}</span>\n        </button>\n    </div>',a.vidurl,a.addvid,a.cancel));e.html(n),e.addClass("evp-modal-open"),this.listManager.find(".evp-playlists-content").hide(),e.show()}},{key:"openEditVideoModal",value:function(e){var t,i,a=jQuery(e.currentTarget).closest(".evp-video-listitem"),n=a.attr("data-key"),s=a.closest(".evp-playlists-content").attr("data-id"),l=this.playListItems[s]||{},o=null!==(t=null==l||null===(i=l.videos)||void 0===i?void 0:i[n])&&void 0!==t?t:{};this.createEditVideoModal(o)}},{key:"createEditVideoModal",value:function(e){var a=t.i18n,n=jQuery(".evp-video-modal"),s=e.thumbnail_url.length?e.thumbnail_url[0]:"",l=jQuery(i('<div class="evp-edit-video-form">\n        <h3>{13}</h3>\n        <div class="evp-edit-video-url evp-edit-video-form-elem"><div><label>{1}</label></div><a href="{2}" target="_blank">{2}</a></div>\n        <div class="evp-edit-video-title evp-edit-video-form-elem">\n            <label for="evp-edit-video-title">{3}</label>\n            <input type="text" id="evp-edit-video-title" value="{4}">\n        </div>\n        <div class="evp-edit-video-thumb evp-edit-video-form-elem">\n            <label for="evp-edit-video-thumb">{9}</label>\n            <input type="text" id="evp-edit-video-thumb" value="{10}">\n        </div>\n        <div class="evp-edit-video-channel evp-edit-video-form-elem">\n            <label for="evp-edit-video-channel">{5}</label>\n            <input type="text" id="evp-edit-video-channel" value="{6}">\n        </div>\n        <div class="evp-edit-video-channel-url evp-edit-video-form-elem">\n            <label for="evp-edit-video-channel-url">{7}</label>\n            <input type="text" id="evp-edit-video-channel-url" value="{8}">\n        </div>\n        <button class="evp-save-edit-info-btn">\n            <span class="dashicons dashicons-update"></span>\n            <span>{11}</span>\n        </button>\n        <button class="evp-cancel-add-video">\n            <span class="dashicons dashicons-no"></span>\n            <span>{12}</span>\n        </button>\n    </div>',a.videourl,e.url,a.title,e.title,a.channel,e.channel_name,a.channelurl,e.channel_url,a.thumbnail,s,a.update,a.cancel,a.editvidinfo));n.html(l),n.addClass("evp-modal-open"),this.listManager.find(".evp-playlists-content").hide(),n.show()}},{key:"closeVideoModal",value:function(){var e=jQuery(".evp-video-modal");e.empty(),e.removeClass("evp-modal-open"),e.hide(),this.listManager.find(".evp-playlists-content").show()}},{key:"addNewVideo",value:function(){var e,i,a=this,n=this.listManager.find(".evp-playlists-content").attr("data-id"),s=this.listManager.find(".evp-video-url").val();if(s){var l=this.analyseUrl(s);if(l){var o=l.provider,d=l.type,r=l.id,v=null!==(e=null===(i=this.playListItems[n])||void 0===i?void 0:i.videos)&&void 0!==e?e:[];if("video"!==d){if("youtube"===o&&!this.api.youtube)return console.log("Please add your YouTube API key."),void(t.setpage&&(window.location.href=t.setpage));if("vimeo"===o&&!this.api.vimeo)return void console.log("Please add your Vimeo API key.")}else for(var p=0;p<v.length;p++)if(v[p][s]===s)return void console.log("Video already exists.");var c={action:"evp_add_new_video",security:t.security,playlist:n,videourl:s,videotype:d,videoid:r,videoprovider:o};jQuery.post(t.ajaxUrl,c,(function(e){if(e.success){var t=e.data;if(t){var i,s;a.playListItems=t,a.render(n),a.closeVideoModal();var l=null!==(i=null===(s=a.playListItems[n])||void 0===s?void 0:s.videos)&&void 0!==i?i:[],o=l.length?l[l.length-1]:{};l.length>v.length&&o.provider&&"url"===o.provider&&a.createEditVideoModal(o)}}else a.closeVideoModal();a.listManager.find(".evp-video-url").val("")}),"json")}else console.log("Please enter a valid video URL.")}else console.log("Please enter a video URL.")}},{key:"analyseUrl",value:function(e){for(var t=0,i=[{pattern:/youtube\.com\/(?:watch\?v=|embed\/|v\/)([\w-]+)(?:$|&(?!list=))/i,type:"video"},{pattern:/youtu\.be\/([\w-]+)/i,type:"video"},{pattern:/youtube\.com\/playlist\?list=([\w-]+)/i,type:"playlist"},{pattern:/youtube\.com\/watch\?v=[\w-]+&list=([\w-]+)/i,type:"playlist"},{pattern:/youtube\.com\/(?:channel|c)\/([\w-]+)/i,type:"channel"},{pattern:/youtube\.com\/user\/([\w-]+)/i,type:"user"},{pattern:/youtube\.com\/@([\w-]+)/i,type:"channelUser"}];t<i.length;t++){var a=i[t],n=a.pattern,s=a.type,l=e.match(n);if(l)return{provider:"youtube",type:s,id:l[1]||""}}for(var o=0,d=[{pattern:/vimeo\.com\/(\d+)/i,type:"video"},{pattern:/vimeo\.com\/channels\/([\w-]+)/i,type:"channel"},{pattern:/vimeo\.com\/album\/(\d+)/i,type:"album"},{pattern:/vimeo\.com\/showcase\/(\d+)/i,type:"showcase"},{pattern:/vimeo\.com\/user\/([\w-]+)/i,type:"user"},{pattern:/vimeo\.com\/groups\/([\w-]+)/i,type:"group"}];o<d.length;o++){var r=d[o],v=r.pattern,p=r.type,c=e.match(v);if(c)return{provider:"vimeo",type:p,id:c[1]||""}}var u=e.split("?")[0].split("."),y=u[u.length-1].toLowerCase();return!!["mp4","m4v","webm","ogv","flv"].includes(y)&&{provider:"url",type:"video",id:""}}},{key:"openPlaylist",value:function(e){var t=jQuery(e.currentTarget),i=t.attr("data-id");this.listManager.find(".evp-play-list-item-active").removeClass("evp-play-list-item-active"),t.addClass("evp-play-list-item-active"),this.closeVideoModal(),this.resetVideoTabs(),this.renderPlaylist(i)}},{key:"deletePlaylist",value:function(e){var i=this,a=jQuery(e.currentTarget).closest(".evp-playlists-content").attr("data-id"),n={action:"evp_delete_playlist",security:t.security,playlist:a};jQuery.post(t.ajaxUrl,n,(function(e){if(e.success){var t=e.data;!1!==t&&(i.playListItems=t,i.closeVideoModal(),i.render())}}),"json")}},{key:"deleteVideo",value:function(e){var i=this.listManager.find(".evp-playlists-content"),a=jQuery(e.currentTarget).closest(".evp-video-listitem"),n=a.attr("data-video"),s=i.attr("data-id");if(n&&s){var l={action:"evp_delete_video",security:t.security,playlist:s,video:n};jQuery.post(t.ajaxUrl,l,(function(e){e.success&&a.remove()}),"json")}}},{key:"saveEditVideoInfo",value:function(){var e=this,i=this.listManager.find(".evp-playlists-content"),a=jQuery(".evp-video-modal"),n=a.find(".evp-edit-video-url a").attr("href"),s=i.attr("data-id");if(n&&s){var l={action:"evp_edit_video_info",security:t.security,playlist:s,video:n,title:a.find("#evp-edit-video-title").val(),thumb:a.find("#evp-edit-video-thumb").val(),channel:a.find("#evp-edit-video-channel").val(),channel_url:a.find("#evp-edit-video-channel-url").val()};jQuery.post(t.ajaxUrl,l,(function(t){if(t.success){var i=t.data;i&&(e.playListItems=i,e.closeVideoModal(),e.render())}}),"json")}}},{key:"savePlaylistSorting",value:function(){var e=this,i=this.listManager.find(".evp-playlists-content").attr("data-id"),a=this.listManager.find(".evp-video-listitem").map((function(e,t){return jQuery(t).attr("data-video")})).get();if(0!==a.length&&i){var n={action:"evp_save_playlist_sorting",security:t.security,playlist:i,videos:a};jQuery.post(t.ajaxUrl,n,(function(t){t.success&&e.listManager.removeClass("evp-video-sorted")}),"json")}}},{key:"toggleTabs",value:function(e){e.preventDefault();var t=jQuery(e.currentTarget),i=t.closest(".evp-playlist-content-tabs"),a=t.attr("data-attr");t.hasClass("evp-tab-active")||(t.siblings(".evp-tab-active").removeClass("evp-tab-active"),t.addClass("evp-tab-active"),i.siblings(".evp-playlist-tab-content").hide(),i.siblings("."+a).show())}},{key:"resetVideoTabs",value:function(){this.listManager.find(".evp-playlist-content-tabs-item").removeClass("evp-tab-active").first().addClass("evp-tab-active"),this.listManager.find(".evp-playlist-tab-content").hide().first().show()}}],s&&n(a.prototype,s),Object.defineProperty(a,"prototype",{writable:!1}),e}();function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function d(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,r(a.key),a)}}function r(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,"string");if("object"!=o(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:String(t)}const v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.playListItems=t.playList||{},this.settingsManager=jQuery("#evp-settings")}var i,a;return i=e,(a=[{key:"init",value:function(){this.settingsManager.length&&this.events()}},{key:"events",value:function(){var e=this;this.settingsManager.find(".evp-settings-toggle-visibility").on("click",e.toggleVisibility.bind(e)),this.settingsManager.find(".evp-settings-api-submit").on("click",e.submitApiKey.bind(e))}},{key:"toggleVisibility",value:function(e){var t=jQuery(e.target).closest(".evp-settings-toggle-visibility"),i=t.closest(".evp-settings-api-input-wrapper").find("input");t.toggleClass("toggled-on"),i.attr("type","text"===i.attr("type")?"password":"text")}},{key:"submitApiKey",value:function(e){var i=jQuery(e.target).siblings(".evp-settings-api-input-wrapper").find("input"),a=i.val(),n=i.data("attr"),s={action:"evp_save_api_key",security:t.security,api_key:n,api_val:a};console.log(s),jQuery.post(t.ajaxUrl,s,(function(e){e.success&&location.reload()}),"json")}}])&&d(i.prototype,a),Object.defineProperty(i,"prototype",{writable:!1}),e}();jQuery((function(e){(new l).init(),(new v).init()}))})();